<div class="container">
    <h1>üìã –ü–µ—Ä–µ—á–µ–Ω—å –ø–ª–∞–Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫</h1>
    <div *ngIf="isLoading" class="loading-overlay">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
    </div>

    <div class="card">
        <div class="card-body">
            <h3>üîç –ü–æ–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–ú–ü</label>
                    <input type="text" [(ngModel)]="search.smpName" class="form-control"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –°–ú–ü">
                </div>

                <div class="form-group">
                    <label>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –æ—Ä–≥–∞–Ω</label>
                    <input type="text" [(ngModel)]="search.controllingAuthority" class="form-control"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ä–≥–∞–Ω">
                </div>

                <div class="form-group">
                    <label>–ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å</label>
                    <div class="date-input-group">
                        <input type="date" [(ngModel)]="search.startDate" class="form-control">
                        <span class="date-separator">–ø–æ</span>
                        <input type="date" [(ngModel)]="search.endDate" class="form-control">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button (click)="clearFilters()" class="btn btn-secondary">
                    <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
                <button (click)="applyFilter()" class="btn btn-primary">
                    <span>üîç</span> –ù–∞–π—Ç–∏
                </button>
                <button (click)="refreshData()" class="btn btn-info">
                    <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr>
                <th>‚Ññ</th>
                <th>–ù–æ–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                <th>–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–π –°–ú–ü</th>
                <th>–ò–ù–ù</th>
                <th>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π –æ—Ä–≥–∞–Ω</th>
                <th>–ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th class="actions-column">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let inspection of displayedInspections; let i = index">
                <td>{{ (pager.currentPage - 1) * pager.perPage + i + 1 }}</td>
                <td>
                    <strong class="text-primary">{{ inspection.inspection_number }}</strong>
                </td>
                <td>
                    <div class="smp-info">
                        <strong>{{ inspection.smp_name }}</strong>
                        <small class="text-muted d-block">ID: {{ inspection.id }}</small>
                    </div>
                </td>
                <td>{{ inspection.smp_inn }}</td>
                <td>{{ inspection.controlling_authority }}</td>
                <td>
                    <div class="date-range">
                        <div class="date-start">{{ formatDate(inspection.start_date) }}</div>
                        <div class="date-separator-small">‚Äî</div>
                        <div class="date-end">{{ formatDate(inspection.end_date) }}</div>
                    </div>
                </td>
                <td>
                    <span class="duration-badge" [class]="getDurationClass(inspection.planned_duration)">
                        {{ inspection.planned_duration }} {{ getDaysText(inspection.planned_duration) }}
                    </span>
                </td>
                <td>
                    <span class="status-badge" [class]="getStatusClass(inspection.status)">
                        {{ getStatusText(inspection.status) }}
                    </span>
                </td>
                <td class="actions-cell">
                    <div class="action-buttons">
                        <button (click)="editInspection(inspection)" class="btn-action btn-edit-action"
                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            ‚úèÔ∏è
                        </button>
                        <button (click)="deleteInspection(inspection.id)" class="btn-action btn-delete-action"
                                title="–£–¥–∞–ª–∏—Ç—å">
                            üóëÔ∏è
                        </button>
                    </div>
                </td>
            </tr>
            <tr *ngIf="displayedInspections.length === 0 && !isLoading">
                <td colspan="10" class="no-data">
                    <div class="empty-state">
                        <span>üì≠</span>
                        <p>–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        <div class="empty-actions">
                            <button (click)="clearFilters()" class="btn btn-primary">
                                –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                            </button>
                            <button (click)="refreshData()" class="btn btn-success">
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="pagination-info" *ngIf="pager">
        <div class="pagination-stats">
            –ü–æ–∫–∞–∑–∞–Ω–æ {{ displayedInspections.length }} –∏–∑ {{ pager.totalItems }} –∑–∞–ø–∏—Å–µ–π
            <span *ngIf="search.smpName || search.controllingAuthority" class="text-muted">
                ‚Ä¢ –§–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–µ–Ω
            </span>
        </div>
        <div class="pagination-controls">
            <button (click)="changePage(pager.currentPage - 1)" [disabled]="pager.currentPage <= 1"
                    class="btn-pagination">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
            <span class="page-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pager.currentPage }} –∏–∑ {{ pager.totalPages }}
            </span>
            <button (click)="changePage(pager.currentPage + 1)"
                    [disabled]="pager.currentPage >= pager.totalPages" class="btn-pagination">
                –í–ø–µ—Ä–µ–¥ ‚Üí
            </button>
            <select [(ngModel)]="pager.perPage" (change)="changePerPage()" class="page-select">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
                <option value="50">50</option>
            </select>
        </div>
    </div>

    <div class="actions-footer">
        <button (click)="addInspection()" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
        <div class="actions-footer-right">
            <button (click)="exportToExcel()" [disabled]="displayedInspections.length === 0"
                    class="btn btn-outline-success">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
            <button (click)="importExcel()" class="btn btn-info ml-2">–ò–º–ø–æ—Ä—Ç –≤ Excel</button>
            <button (click)="downloadTemplate()" class="btn btn-info ml-2">–°–∫–∞—á–∞—Ç—å —à–∞–ª–±–ª–æ–Ω</button>
        </div>
    </div>
</div>